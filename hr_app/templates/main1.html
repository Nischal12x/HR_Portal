{% load static %}
<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}BISP Solutions{% endblock %}</title>
<!-- FullCalendar CSS -->
<!--<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/main.min.css" rel="stylesheet">-->

<link rel="stylesheet" href="{% static 'plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css' %}">
  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="{% static 'plugins/fontawesome-free/css/all.min.css' %}">
    <!-- DataTables -->
    <link rel="stylesheet" href="{% static 'plugins/datatables-bs4/css/dataTables.bootstrap4.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/datatables-responsive/css/responsive.bootstrap4.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/datatables-buttons/css/buttons.bootstrap4.min.css' %}">
    <!-- Theme style -->
    <link rel="stylesheet" href="{% static 'css/adminlte.min.css' %}">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="{% static 'plugins/fontawesome-free/css/all.min.css' %}">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Tempusdominus Bootstrap 4 -->
  <link rel="stylesheet" href="{% static 'plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css' %}">
  <!-- iCheck -->
  <link rel="stylesheet" href="{% static 'plugins/icheck-bootstrap/icheck-bootstrap.min.css' %}">
  <!-- JQVMap -->
  <link rel="stylesheet" href="{% static 'plugins/jqvmap/jqvmap.min.css' %}">
  <!-- Theme style -->
  <link rel="stylesheet" href="{% static 'css/adminlte.min.css' %}">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="{% static 'plugins/overlayScrollbars/css/OverlayScrollbars.min.css' %}">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="{% static 'plugins/daterangepicker/daterangepicker.css' %}">
  <!-- Summernote -->
  <link rel="stylesheet" href="{% static 'plugins/summernote/summernote-bs4.min.css' %}">

  <link rel="stylesheet" href="{% static 'plugins/overlayScrollbars/css/OverlayScrollbars.min.css' %}">
<!--  style for leave table -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
  <!-- DataTables JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
  <style>
  .text-end {
    text-align: right;
    margin-top: 10px; /* Optional spacing */
    margin-bottom: 10px;
  }
    /* Container with proper spacing */
.dashboard-container {
  width: 100%;
  max-width: 100%;
  padding: 20px 15px;  /* minimal left and right padding */
  box-sizing: border-box;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.dashboard-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
}


/* Card style */
.card-box {
  background-color: #ffffff;
  display: flex;
  align-items: center;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
  transition: box-shadow 0.3s ease;
  border: 1px solid #e6e6e6;
}

.card-box:hover {
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
}

.icon-box {
  width: 50px;
  height: 50px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 15px;
  font-size: 20px;
  color: white;
}

.info .label {
  font-size: 0.9rem;
  color: #555;
  font-weight: 600;
  margin-bottom: 3px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.info .count {
  font-size: 1.6rem;
  font-weight: bold;
  color: #111;
}

/* Accent icon colors */
.bg-blue { background-color: #007bff; }
.bg-green { background-color: #28a745; }
.bg-yellow { background-color: #ffc107; color: #000; }
.bg-red { background-color: #dc3545; }
.bg-teal { background-color: #17a2b8; }
.bg-gray { background-color: #6c757d; }

</style>

  <style>
    /* Pagination Styling */
.dataTables_paginate .paginate_button {
  border-radius: 5px;
  margin: 0 5px;
  padding: 5px 10px;
  background-color: #007bff;
  color: white;
  cursor: pointer;
}

.dataTables_paginate .paginate_button:hover {
  background-color: #0056b3;
}

.dataTables_paginate .paginate_button.current {
  background-color: #0056b3;
  cursor: default;
}

.dataTables_filter input {
  border-radius: 5px;
  padding: 5px;
  border: 1px solid #ccc;
  margin-left: 20px;
}

  /* Styling for table headers */
thead {
  background-color: #f8f9fa;
}

/* Status icon styling */
.status-icon {
  font-size: 18px;
  margin-right: 10px;
}

/* Hover effect on table rows */
table tbody tr:hover {
  background-color: #f1f1f1;
}

/* Styling for dropdown in status column */
.statusSelect {
  width: 100%;
  padding: 5px;
  border-radius: 5px;
  border: 1px solid #ccc;
}

/* Additional customization for form control inside table */
.form-control {
  padding: 0.5rem 1rem;
}
</style>

  <style>

    .status-container {
      display: flex;
      align-items: center;
      font-family: Arial, sans-serif;
      font-size: 16px;
      margin-bottom: 10px;
    }

    .status-icon {
      font-size: 18px;
      margin-right: 8px;
    }

    .pending { color: #f1c40f; }
    .cancelled { color: #e74c3c; }
    .approved { color: #2ecc71; }

    select {
      padding: 8px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
      outline: none;
      cursor: pointer;
    }
        .entries-container {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            font-family: Arial, sans-serif;
            font-size: 14px;
        }
        .entries-container label {
            margin-right: 5px;
            font-weight: bold;
        }
        .entries-container select {
            padding: 4px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            margin: 0 5px;
        }
    .status-icon.Pending { color: #ffc107; }     /* yellow */
.status-icon.Approved { color: #28a745; }    /* green */
.status-icon.Cancelled { color: #dc3545; }   /* red */
.status-icon.Withdrawn { color: #6c757d; }   /* gray */

.error-message {
    font-size: 0.85em;
    color: red;
}

    </style>
<!--  for project task panel-->
<style>
/* Card hover effect */
.card.task-card {
    transition: 0.3s ease;
}

/* Status Badge Position */
.status-badge-wrapper {
    top: 10px;
    left: 10px;
}

/* Task Content spacing */

.task-content {
    margin-top: 2.5rem; /* little more gap after badge */
}



/* Badge Menu Styles (already you had it, slightly improved) */
.status-menu {
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 6px;
    padding: 5px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    animation: zoomIn 0.2s ease;
    z-index: 100;
    position: absolute;
    top: 30px;
    left: 0;
    min-width: 120px;
}

.status-menu div {
    cursor: pointer;
    padding: 5px 8px;
    font-size: 0.85rem;
}

.status-menu div:hover {
    background-color: #f0f0f0;
    border-radius: 4px;
}
</style>
<!--  for projcet details task -->
<!-- Custom Design CSS -->
<style>
/* ========== Animations ========== */

/* ========== Layout Cards ========== */
.main-card {
  background: #f7f9fc;
  border: 1px solid #d3dce6;
  border-radius: 12px;
  animation: fadeInUp 0.6s ease forwards;
}

.section-card {
  background: #ffffff;
  padding: 20px;
  margin-bottom: 20px;
  border: 1px solid #dbe2ef;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
  opacity: 0;
  transform: translateY(10px);
  animation: fadeInUp 0.8s ease forwards;
  animation-delay: 0.2s;
  animation-fill-mode: forwards;
}

.section-heading {
  font-size: 1.3rem;
  color: #003566;
  border-bottom: 2px solid #00b4d8;
  padding-bottom: 10px;
  margin-bottom: 20px;
}

/* ========== Field Elements ========== */
.field-label {
  font-weight: 600;
  color: #03045e;
  margin-bottom: 5px;
}

.field-input {
  background-color: #e0f7fa;
  border: 1px solid #b2ebf2;
}

/* ========== Description & Team ========== */
.description-box {
  background: #e3f2fd;
  border: 1px dashed #90caf9;
  padding: 10px;
  border-radius: 8px;
  max-height: 150px;
  overflow-y: auto;
}

.team-details li {
  padding: 6px 0;
  color: #555;
}

/* ========== Animations ========== */
@keyframes fadeInUp {
  0% { opacity: 0; transform: translateY(20px); }
  100% { opacity: 1; transform: translateY(0); }
}

@keyframes zoomIn {
  0% { opacity: 0; transform: scale(0.9); }
  100% { opacity: 1; transform: scale(1); }
}

/* ========== Layout Cards ========== */
.main-card {
  background: #f7f9fc;
  border: 1px solid #d3dce6;
  border-radius: 12px;
  animation: fadeInUp 0.6s ease forwards;
}

.section-card {
  background: #ffffff;
  padding: 20px;
  margin-bottom: 20px;
  border: 1px solid #dbe2ef;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
  animation: fadeInUp 0.8s ease forwards;
  animation-delay: 0.2s;
  animation-fill-mode: forwards;
}

/* ========== Headings ========== */
.section-heading {
  font-size: 1.3rem;
  color: #003566;
  border-bottom: 2px solid #00b4d8;
  padding-bottom: 10px;
  margin-bottom: 20px;
}

/* ========== Form Fields ========== */
.field-label {
  font-weight: 600;
  color: #03045e;
  margin-bottom: 5px;
}


/* ========== Description & Team ========== */
.description-box {
  background: #e3f2fd;
  border: 1px dashed #90caf9;
  padding: 10px;
  border-radius: 8px;
  max-height: 150px;
  overflow-y: auto;
}

.team-details li {
  padding: 6px 0;
  color: #555;
}

/* ========== Task Card ========== */
/* Task card style */
.task-card {
  background: linear-gradient(135deg, #e0f7fa, #f1f8e9);
  border-radius: 10px;
  position: relative;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

/* Hover effect */


/* Status badge style */
.task-status {
  transition: background-color 0.3s ease;
  cursor: pointer;
}

/* Different color styles for statuses */
.bg-pending {
  background-color: #ffc107 !important;
}

.bg-completed {
  background-color: #28a745 !important;
}

.bg-claimed {
  background-color: #17a2b8 !important;
}

  td form .form-control {
  border-radius: 5px;
  font-size: 0.85rem;
}

td form .btn-sm {
  padding: 4px 8px;
  margin-top: 3px;
}

td form select.custom-select-sm {
  font-size: 0.85rem;
}

td .btn + .btn {
  margin-left: 5px;
}
  </style>
</head>
<body class="hold-transition sidebar-mini layout-fixed">

<!-- CSRF token for JavaScript fetch() -->
<input type="hidden" id="csrf-token" value="{{ csrf_token }}">

{% block content %}
{% endblock %}



<!-- REQUIRED SCRIPTS -->
<script src="{% static 'plugins/jquery/jquery.min.js' %}"></script>
<script src="{% static 'plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>

<!-- DataTables & Plugins -->
<script src="{% static 'plugins/datatables/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'plugins/datatables-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
<script src="{% static 'plugins/datatables-responsive/js/dataTables.responsive.min.js' %}"></script>
<script src="{% static 'plugins/datatables-responsive/js/responsive.bootstrap4.min.js' %}"></script>
<script src="{% static 'plugins/datatables-buttons/js/dataTables.buttons.min.js' %}"></script>
<script src="{% static 'plugins/datatables-buttons/js/buttons.bootstrap4.min.js' %}"></script>
<script src="{% static 'plugins/jszip/jszip.min.js' %}"></script>
<script src="{% static 'plugins/pdfmake/pdfmake.min.js' %}"></script>
<script src="{% static 'plugins/pdfmake/vfs_fonts.js' %}"></script>
<script src="{% static 'plugins/datatables-buttons/js/buttons.html5.min.js' %}"></script>
<script src="{% static 'plugins/datatables-buttons/js/buttons.print.min.js' %}"></script>
<script src="{% static 'plugins/datatables-buttons/js/buttons.colVis.min.js' %}"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- PDF.js library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
<!-- AdminLTE App -->
<script src="{% static 'js/adminlte.min.js' %}"></script>
<script src="{% static 'js/demo.js' %}"></script>

<!-- Additional Plugins -->
<script src="{% static 'plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- External CDN Scripts (if needed apart from static) -->

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.6.0/js/bootstrap.bundle.min.js"></script>

<!-- PAGE-SPECIFIC SCRIPTS -->

<!-- DataTable Initialization -->
<script>
  $(document).ready(function () {
    // Table 1
    if (!$.fn.dataTable.isDataTable('#example1')) {
      $('#example1').DataTable({
        "responsive": true,
        "lengthChange": false,
        "autoWidth": false,
        "buttons": ["copy", "csv", "excel", "pdf", "print", "colvis"]
      }).buttons().container().appendTo('#example1_wrapper .col-md-6:eq(0)');
    }

    // Table 2
    if (!$.fn.dataTable.isDataTable('#example2')) {
      $('#example2').DataTable({
        "paging": true,
        "lengthChange": false,
        "searching": true,
        "ordering": true,
        "info": true,
        "autoWidth": false,
        "responsive": true,
        "buttons": ["copy", "csv", "excel", "pdf", "print", "colvis"]
      }).buttons().container().appendTo('#example2_wrapper .col-md-6:eq(0)');
    }
  });
</script>
<!-- this is for dashboard panel-->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const counters = document.querySelectorAll(".count");
    counters.forEach(counter => {
      const target = +counter.getAttribute("data-count");
      const speed = 50;
      const updateCount = () => {
        const current = +counter.innerText;
        const increment = Math.ceil(target / speed);
        if (current < target) {
          counter.innerText = current + increment;
          setTimeout(updateCount, 20);
        } else {
          counter.innerText = target;
        }
      };
      updateCount();
    });
  });
</script>

<!-- Leave Status Update -->
<script>
  function updateStatus(selectElement) {
    const statusIcon = selectElement.previousElementSibling;
    statusIcon.className = 'fas status-icon';

    switch (selectElement.value) {
      case 'Pending':
        statusIcon.classList.add('fa-clock', 'Pending');
        break;
      case 'Cancelled':
        statusIcon.classList.add('fa-times', 'Cancelled');
        break;
      case 'Approved':
        statusIcon.classList.add('fa-check', 'Approved');
        break;
      case 'Withdrawn':
        statusIcon.classList.add('fa-ban', 'Withdrawn');
        break;
    }
  }
</script>

<!-- Toggle Tabs in Leave Form -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const allEmployeeRadio = document.getElementById('allEmployees');
    const individualEmployeeRadio = document.getElementById('individualEmployee');
    const applicableTab = document.querySelector('a[href="#applicable"]');
    const applicableContent = document.getElementById('applicable');
    const entitlementContent = document.getElementById('entitlement');
    const allEntitlementChildren = entitlementContent.querySelectorAll('.row');
    const department = document.getElementById('department');
    const employee = document.getElementById('employee');
    const genderRadios = document.querySelectorAll('input[name="gender"]');
    const maritalRadios = document.querySelectorAll('input[name="maritalStatus"]');
    const effectiveAfter = document.getElementById('effective_after');
    const timeUnit = document.getElementById('time_unit');
    const fromFieldRadios = document.querySelectorAll('input[name="from_field"]');

    function getSelectedFromFieldValue() {
      const checkedRadio = [...fromFieldRadios].find(r => r.checked);
      return checkedRadio ? checkedRadio.value : null;
    }

    function toggleTabs() {
      const fromFieldValue = getSelectedFromFieldValue();

      if (allEmployeeRadio.checked) {
        applicableTab.style.visibility = 'hidden';
        applicableContent.style.visibility = 'hidden';
        applicableContent.style.position = 'absolute';
        applicableTab.style.position = 'absolute';

        allEntitlementChildren.forEach((row, index) => {
          row.style.display = (index === 1) ? 'flex' : 'none';
        });

        department.removeAttribute('required');
        employee.removeAttribute('required');
        genderRadios.forEach(r => r.required = false);
        maritalRadios.forEach(r => r.required = false);

        if (fromFieldValue !== 'custom_date') {
          effectiveAfter.removeAttribute('required');
          timeUnit.removeAttribute('required');
        }

        document.querySelector('a[href="#entitlement"]').click();
      } else {
        applicableTab.style.visibility = 'visible';
        applicableContent.style.visibility = 'visible';
        applicableContent.style.position = 'static';
        applicableTab.style.position = 'static';

        allEntitlementChildren.forEach(row => {
          row.style.display = 'flex';
        });
      }
    }

    toggleTabs();
    fromFieldRadios.forEach(radio => radio.addEventListener('change', toggleTabs));
    allEmployeeRadio.addEventListener('change', toggleTabs);
    individualEmployeeRadio.addEventListener('change', toggleTabs);
  });
</script>

<!-- Toggle Custom Date -->
<script>
  function toggleCustomDate(show) {
    const customDateInput = document.getElementById('customDateInput');
    const customRadio = document.getElementById('custom');
    if (customRadio.checked && show) {
      customDateInput.style.display = 'block';
      document.getElementById('custom_date').setAttribute('required', 'required');
    } else {
      customDateInput.style.display = 'none';
      document.getElementById('custom_date').removeAttribute('required');
    }
  }

  window.addEventListener('DOMContentLoaded', () => {
    toggleCustomDate(document.getElementById('custom').checked);
  });
</script>

<!-- Fetch Employees by Filters -->
<script>
  function fetchEmployees() {
    const gender = document.querySelector('input[name="gender"]:checked')?.value || "";
    const maritalStatus = document.querySelector('input[name="maritalStatus"]:checked')?.value || "";
    const department = document.getElementById('department')?.value || "";

    fetch(`/get-employees/?gender=${gender}&marital_status=${maritalStatus}&department=${department}`)
      .then(response => response.json())
      .then(data => {
        const employeeSelect = document.getElementById('employee');
        employeeSelect.innerHTML = '<option value="">Select Employee</option>';
        data.employees.forEach(emp => {
          const option = document.createElement('option');
          option.value = emp.id;
          option.text = emp.name;
          employeeSelect.appendChild(option);
        });
      }).catch(error => console.error("Fetch error:", error));
  }

  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('input[name="gender"], input[name="maritalStatus"]').forEach(el => {
      el.addEventListener('change', fetchEmployees);
    });
    document.getElementById('department').addEventListener('change', fetchEmployees);
  });
</script>

<!-- Toggle Expanded Leave Details -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const buttons = document.querySelectorAll('.toggle-btn');
    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.getAttribute('data-id');
        const row = document.getElementById(`details-${id}`);
        const isVisible = row.style.display === 'table-row';
        row.style.display = isVisible ? 'none' : 'table-row';
        btn.textContent = isVisible ? '+' : '-';
      });
    });
  });
</script>

<!-- DOB Validation -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const dobInput = document.getElementById('dob');
    const today = new Date();
    const maxDate = new Date(today);
    const minDate = new Date(today);
    minDate.setFullYear(today.getFullYear() - 60);
    dobInput.min = minDate.toISOString().split('T')[0];
    dobInput.max = maxDate.toISOString().split('T')[0];
  });
</script>

<!-- Joining Date Validation -->
{% if not employee %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const joinDate = document.getElementById('joining_date');
    const today = new Date();
    const fourMonthsAgo = new Date(today);
    fourMonthsAgo.setMonth(today.getMonth() - 4);
    const fourMonthsLater = new Date(today);
    fourMonthsLater.setMonth(today.getMonth() + 4);
    joinDate.min = fourMonthsAgo.toISOString().split('T')[0];
    joinDate.max = fourMonthsLater.toISOString().split('T')[0];
  });
</script>
{% endif %}

<!-- View More/Less Toggle -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const buttons = document.querySelectorAll(".toggle-more");

    buttons.forEach(button => {
      button.addEventListener("click", function () {
        const leaveId = this.getAttribute("data-leave-id");
        const rows = document.querySelectorAll(`.leave-row-${leaveId}.extra-row`);
        rows.forEach(row => {
          row.classList.toggle("d-none");
        });
        this.textContent = this.textContent === "View More" ? "View Less" : "View More";
      });
    });
  });
</script>

<!-- Leave Cancel Reason Validation -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const forms = document.querySelectorAll('form');

    forms.forEach(function (form) {
      const select = form.querySelector('.statusSelect');
      const reasonContainer = form.querySelector('#cancel-reason-container');
      const reasonInput = form.querySelector('#cancel-reason');

      if (!select) return;

      select.addEventListener('change', function () {
        const selectedValue = select.value;

        if (selectedValue === 'Cancelled') {
          reasonContainer.style.display = 'block';
        } else {
          reasonContainer.style.display = 'none';
          form.submit();
        }
      });

      form.addEventListener('submit', function (e) {
        if (select.value === 'Cancelled' && reasonInput.value.trim() === '') {
          e.preventDefault();
          alert("Please provide a reason for cancellation.");
          reasonInput.focus();
        }
      });
    });
  });
</script>
<!--scripts for project-->
<script src="{% static 'plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js' %}"></script>

<!--for project module add_project-->
<script>
$(document).ready(function () {
  // Unbind any previous submit handler to avoid duplicates
  $('#projectForm').off('submit').on('submit', function(e) {
    e.preventDefault();
    let formData = new FormData(this);

    $.ajax({
      url: "{% if project %}{% url 'add_project' project.id %}{% else %}{% url 'add_project' 0 %}{% endif %}",
      type: "POST",
      data: formData,
      processData: false,
      contentType: false,
      headers: { "X-Requested-With": "XMLHttpRequest" },
      success: function(response) {
          if (response.success) {
              alert(response.message);
              window.location.href = "{% url 'widgets' %}";
          }
      },
      error: function(xhr) {
        $('.text-danger').text(""); // Clear errors
        try {
          const errors = xhr.responseJSON.errors;
          Object.keys(errors).forEach(field => {
            $(`#error-${field}`).text(errors[field]);
          });
        } catch (e) {
          console.error("Unhandled error:", e);
        }
      }
    });
  });
});
</script>
<!--for projecet-details tasks-->
<script>
function showStatusMenu(badge) {
  const menu = badge.nextElementSibling;
  menu.classList.toggle('d-none');
}

function setStatus(option, text, badgeClass) {
  const statusBadge = option.parentElement.previousElementSibling;

  statusBadge.textContent = text;
  statusBadge.className = 'badge task-status ' + badgeClass;

  // Hide the menu again
  option.parentElement.classList.add('d-none');
}
</script>
<!--for update employee-->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    $('[data-toggle="tooltip"]').tooltip();  // Enable Bootstrap tooltips

    document.querySelectorAll('.action-select').forEach(select => {
      select.addEventListener('change', function() {
        const form = this.closest('form');
        const field = form.querySelector('.new-value-field');
        const submitBtn = form.querySelector('.submit-btn');
        const selected = this.value;

        field.innerHTML = '';
        submitBtn.classList.remove('d-none');

        let inputHTML = '';
        if (selected === 'department') {
          inputHTML = `
            <select name="new_department" class="form-control form-control-sm" required>
              <option value="" disabled selected>Select Dept</option>
              <option value="IT">IT</option>
              <option value="HR">HR</option>
              <option value="Marketing">Marketing</option>
              <option value="Finance">Finance</option>
            </select>`;
        } else if (selected === 'designation') {
          inputHTML = `<input type="text" name="new_designation" class="form-control form-control-sm" placeholder="New designation" required>`;
        } else if (selected === 'salary') {
          inputHTML = `<input type="number" name="new_salary" step="0.01" class="form-control form-control-sm" placeholder="New salary" required>`;
        }

        field.innerHTML = inputHTML;
      });
    });
  });
</script>
<!--this is for task options status to toggle and update in db-->
<script>
  // Show dropdown menu for a specific task
  function showStatusMenu(badgeElement) {
    // Hide all other status menus first
    document.querySelectorAll('.status-menu').forEach(menu => menu.classList.add('d-none'));

    // Toggle the current one
    const menu = badgeElement.nextElementSibling;
    if (menu && menu.classList.contains('status-menu')) {
      menu.classList.toggle('d-none');
    }

    // Stop propagation so the click doesn't bubble to document and close it instantly
    event.stopPropagation();
  }

  // Submit status change
  function submitStatus(status, taskId) {
    const statusInput = document.getElementById(`statusInput-${taskId}`);
    const statusForm = document.getElementById(`statusForm-${taskId}`);
    statusInput.value = status;
    statusForm.submit();
  }

  // Close status menus when clicking outside
  document.addEventListener('click', function (event) {
    const clickedInsideMenu = event.target.closest('.status-menu');
    const clickedStatusBadge = event.target.closest('.task-status');

    if (!clickedInsideMenu && !clickedStatusBadge) {
      document.querySelectorAll('.status-menu').forEach(menu => menu.classList.add('d-none'));
    }
  });
</script>

<!--&lt;!&ndash; FullCalendar + Bootstrap dependencies &ndash;&gt;-->
<!--<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.9/index.global.min.js"></script>-->
<!--<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.9/index.global.min.js"></script>-->
<!--<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/interaction@6.1.9/index.global.min.js"></script>-->
<!--<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/bootstrap@6.1.9/index.global.min.js"></script>-->
<script>
  function toggleView(view) {
    document.getElementById('calendar-card').style.display = view === 'calendar' ? 'block' : 'none';
    document.getElementById('table-card').style.display = view === 'table' ? 'block' : 'none';
  }

  document.addEventListener('DOMContentLoaded', function() {
    const calendarEl = document.getElementById('calendar');

    const calendar = new FullCalendar.Calendar(calendarEl, {
      themeSystem: 'bootstrap',
      initialView: 'dayGridMonth',
      height: 650,
      events: '{{ request.scheme }}://{{ request.get_host }}{% url "holiday_json" %}',
      eventDidMount: function(info) {
        // Tooltip on hover (optional)
        $(info.el).tooltip({
          title: info.event.title + ' - ' + (info.event.extendedProps.description || 'No description'),
          placement: 'top',
          trigger: 'hover',
          container: 'body'
        });
      },
      eventClick: function(info) {
        const title = info.event.title;
        const desc = info.event.extendedProps.description || 'No description';
        document.getElementById('holiday-details').innerHTML = `<strong>${title}</strong><br>${desc}`;
        $('#holidayInfoModal').modal('show');
      }
    });

    calendar.render();
  });
</script>
</body>
</html>
